-- Misc Module
-- Loads tools from GitHub and provides Reset Rotation & Clear All Forces

local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local MiscModule = {}

local TEXT_COL = Color3.fromRGB(0, 0, 0)
local BTN_OFF = Color3.fromRGB(255, 255, 255)
local BTN_ON = Color3.fromRGB(240, 220, 230)
local SLIDER_BG = Color3.fromRGB(255, 255, 255)
local SLIDER_FILL = Color3.fromRGB(0, 0, 0)
local CHECK_OFF = Color3.fromRGB(180, 180, 180)
local CHECK_ON = Color3.fromRGB(255, 255, 255)
local TXT_BG = Color3.fromRGB(255, 255, 255)

local ToolURLs = {
    MoveTool = "https://raw.githubusercontent.com/givenship/Unanchor.euva/refs/heads/main/MoveTool",
    RotateTool = "https://raw.githubusercontent.com/givenship/Unanchor.euva/refs/heads/main/RotateTool",
    RingShape = "https://raw.githubusercontent.com/givenship/Unanchor.euva/refs/heads/main/RingShape",
    RPMTool = "https://raw.githubusercontent.com/givenship/Unanchor.euva/refs/heads/main/RPMTool"
}

local LoadedTools = {}

local function loadTool(toolName, url)
    if LoadedTools[toolName] then return LoadedTools[toolName] end
    local success, result = pcall(function() return game:HttpGet(url) end)
    if success then
        local toolFunc, err = loadstring(result)
        if toolFunc then
            local tool = toolFunc()
            LoadedTools[toolName] = tool
            return tool
        else
            warn("Error loading " .. toolName .. ": " .. tostring(err))
            return nil
        end
    else
        warn("Failed to download " .. toolName)
        return nil
    end
end

function MiscModule.CreateUI(parent)
    local miscContent = Instance.new("ScrollingFrame")
    miscContent.Size = UDim2.new(1, 0, 1, 0)
    miscContent.BackgroundTransparency = 1
    miscContent.BorderSizePixel = 0
    miscContent.ScrollBarThickness = 4
    miscContent.ScrollBarImageColor3 = Color3.fromRGB(200, 180, 190)
    miscContent.Parent = parent

    local yPos = 10

    -- Section title with white background
    local function createSectionTitle(text, position)
        local bg = Instance.new("Frame")
        bg.Size = UDim2.new(1, -20, 0, 28)
        bg.Position = UDim2.new(0, 10, 0, position)
        bg.BackgroundColor3 = TXT_BG
        bg.BorderSizePixel = 0
        bg.ZIndex = 66
        bg.Parent = miscContent

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, -8, 1, 0)
        label.Position = UDim2.new(0, 4, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.Font = Enum.Font.GothamBold
        label.TextSize = 15
        label.TextColor3 = TEXT_COL
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 67
        label.Parent = bg
        return position + 38
    end

    local function createButton(name, position, callback)
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, -20, 0, 35)
        button.Position = UDim2.new(0, 10, 0, position)
        button.BackgroundColor3 = BTN_OFF
        button.BorderSizePixel = 0
        button.AutoButtonColor = false
        button.Text = name
        button.Font = Enum.Font.Gotham
        button.TextSize = 14
        button.TextColor3 = TEXT_COL
        button.ZIndex = 68
        button.Parent = miscContent

        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 6)
        corner.Parent = button

        button.MouseEnter:Connect(function() button.BackgroundColor3 = BTN_ON end)
        button.MouseLeave:Connect(function()
            -- Only revert if not in "enabled" state
            if not button:GetAttribute("Active") then
                button.BackgroundColor3 = BTN_OFF
            end
        end)

        button.MouseButton1Click:Connect(function()
            callback(button)
        end)
        return button, position + 45
    end

    local function createSlider(name, position, minVal, maxVal, currentValue, callback)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(1, -20, 0, 50)
        container.Position = UDim2.new(0, 10, 0, position)
        container.BackgroundTransparency = 1
        container.ZIndex = 65
        container.Parent = miscContent

        local labelBg = Instance.new("Frame")
        labelBg.Size = UDim2.new(0, 120, 0, 20)
        labelBg.Position = UDim2.new(0, 0, 0, 5)
        labelBg.BackgroundColor3 = TXT_BG
        labelBg.BorderSizePixel = 0
        labelBg.ZIndex = 66
        labelBg.Parent = container

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, -4, 1, 0)
        label.Position = UDim2.new(0, 2, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = name .. ": " .. currentValue
        label.Font = Enum.Font.Gotham
        label.TextSize = 12
        label.TextColor3 = TEXT_COL
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 67
        label.Parent = labelBg

        local sliderBg = Instance.new("Frame")
        sliderBg.Size = UDim2.new(1, -130, 0, 20)
        sliderBg.Position = UDim2.new(0, 125, 0, 25)
        sliderBg.BackgroundColor3 = SLIDER_BG
        sliderBg.BorderSizePixel = 0
        sliderBg.ZIndex = 68
        sliderBg.Parent = container

        local sc = Instance.new("UICorner")
        sc.CornerRadius = UDim.new(0, 4)
        sc.Parent = sliderBg

        local sliderFill = Instance.new("Frame")
        sliderFill.Size = UDim2.new((currentValue - minVal) / (maxVal - minVal), 0, 1, 0)
        sliderFill.BackgroundColor3 = SLIDER_FILL
        sliderFill.BorderSizePixel = 0
        sliderFill.ZIndex = 69
        sliderFill.Parent = sliderBg

        local fc = Instance.new("UICorner")
        fc.CornerRadius = UDim.new(0, 4)
        fc.Parent = sliderFill

        local sliderButton = Instance.new("TextButton")
        sliderButton.Size = UDim2.new(1, 0, 1, 0)
        sliderButton.BackgroundTransparency = 1
        sliderButton.Text = ""
        sliderButton.ZIndex = 70
        sliderButton.Parent = sliderBg

        local dragging = false
        sliderButton.MouseButton1Down:Connect(function() dragging = true end)
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
        end)
        RunService.RenderStepped:Connect(function()
            if dragging then
                local mousePos = UserInputService:GetMouseLocation()
                local relativeX = math.clamp(mousePos.X - sliderBg.AbsolutePosition.X, 0, sliderBg.AbsoluteSize.X)
                local percentage = relativeX / sliderBg.AbsoluteSize.X
                local value = minVal + (maxVal - minVal) * percentage
                if maxVal - minVal <= 10 then
                    value = math.floor(value * 10) / 10
                else
                    value = math.floor(value)
                end
                sliderFill.Size = UDim2.new((value - minVal) / (maxVal - minVal), 0, 1, 0)
                label.Text = name .. ": " .. value
                if callback then callback(value) end
            end
        end)
        return position + 60
    end

    -- Helper to set button active state
    local function setActive(btn, active)
        btn:SetAttribute("Active", active)
        btn.BackgroundColor3 = active and BTN_ON or BTN_OFF
    end

    -- PART CONTROLLER Section
    yPos = createSectionTitle("PART CONTROLLER", yPos)

    local moveToolBtn, rotateToolBtn, ringBtn, spinBtn, safeNosBtn

    moveToolBtn, yPos = createButton("Move Tool", yPos, function(button)
        local moveTool = loadTool("MoveTool", ToolURLs.MoveTool)
        if not moveTool then return end
        if moveTool.IsEnabled() then
            moveTool.Disable()
            setActive(button, false)
        else
            if LoadedTools.RotateTool and LoadedTools.RotateTool.IsEnabled() then
                LoadedTools.RotateTool.Disable()
                if rotateToolBtn then setActive(rotateToolBtn, false) end
            end
            moveTool.Enable()
            setActive(button, true)
        end
    end)

    rotateToolBtn, yPos = createButton("Rotate Tool", yPos, function(button)
        local rotateTool = loadTool("RotateTool", ToolURLs.RotateTool)
        if not rotateTool then return end
        if rotateTool.IsEnabled() then
            rotateTool.Disable()
            setActive(button, false)
        else
            if LoadedTools.MoveTool and LoadedTools.MoveTool.IsEnabled() then
                LoadedTools.MoveTool.Disable()
                if moveToolBtn then setActive(moveToolBtn, false) end
            end
            rotateTool.Enable()
            setActive(button, true)
        end
    end)

    local resetBtn
    resetBtn, yPos = createButton("Reset Rotation", yPos, function()
        local selectedConnectedParts = {}
        if LoadedTools.MoveTool and LoadedTools.MoveTool.GetSelectedConnectedParts then
            selectedConnectedParts = LoadedTools.MoveTool.GetSelectedConnectedParts()
        elseif LoadedTools.RotateTool and LoadedTools.RotateTool.GetSelectedConnectedParts then
            selectedConnectedParts = LoadedTools.RotateTool.GetSelectedConnectedParts()
        end
        if #selectedConnectedParts > 0 then
            for _, connectedPart in ipairs(selectedConnectedParts) do
                if connectedPart and connectedPart.Parent then
                    local bg = connectedPart:FindFirstChild("MoveToolGyro")
                    if bg and bg:IsA("BodyGyro") then
                        bg.CFrame = CFrame.new(connectedPart.Position)
                    end
                end
            end
            print("Rotation reset")
        else
            warn("No part selected")
        end
    end)

    local clearBtn
    clearBtn, yPos = createButton("Clear All Forces", yPos, function()
        for _, part in ipairs(game.Workspace:GetDescendants()) do
            if part:IsA("BasePart") then
                for _, child in ipairs(part:GetChildren()) do
                    if child.Name == "MoveToolPosition" or child.Name == "MoveToolGyro" or
                       child.Name == "RingPosition" or child.Name == "RingGyro" or
                       child.Name == "SpinVelocity" then
                        child:Destroy()
                    end
                end
            end
        end
        if LoadedTools.MoveTool then LoadedTools.MoveTool.Disable() end
        if LoadedTools.RotateTool then LoadedTools.RotateTool.Disable() end
        if LoadedTools.RingShape then LoadedTools.RingShape.Disable() end
        if LoadedTools.RPMTool then LoadedTools.RPMTool.Disable() end
        setActive(moveToolBtn, false)
        setActive(rotateToolBtn, false)
        if ringBtn then setActive(ringBtn, false) end
        if spinBtn then setActive(spinBtn, false) end
        print("All forces cleared")
    end)

    yPos = yPos + 10

    -- RING FORMATION Section
    yPos = createSectionTitle("RING FORMATION", yPos)

    ringBtn, yPos = createButton("Ring Shape", yPos, function(button)
        local ringShape = loadTool("RingShape", ToolURLs.RingShape)
        if not ringShape then return end
        if ringShape.IsEnabled() then
            ringShape.Disable()
            setActive(button, false)
        else
            ringShape.Enable()
            setActive(button, true)
        end
    end)

    yPos = createSlider("Ring Radius", yPos, 5, 50, 10, function(value)
        if LoadedTools.RingShape then LoadedTools.RingShape.SetRadius(value) end
    end)

    yPos = createSlider("Ring Height", yPos, -10, 20, 3, function(value)
        if LoadedTools.RingShape then LoadedTools.RingShape.SetHeight(value) end
    end)

    yPos = createSlider("Ring Rotation", yPos, 0, 360, 0, function(value)
        if LoadedTools.RingShape then LoadedTools.RingShape.SetRotation(value) end
    end)

    yPos = yPos + 10

    -- SPIN PARTS Section
    yPos = createSectionTitle("SPIN PARTS", yPos)

    spinBtn, yPos = createButton("Spin Parts", yPos, function(button)
        local rpmTool = loadTool("RPMTool", ToolURLs.RPMTool)
        if not rpmTool then return end
        if rpmTool.IsEnabled() then
            rpmTool.Disable()
            setActive(button, false)
        else
            rpmTool.SetGetSelectedPartsFunction(function()
                if LoadedTools.MoveTool and LoadedTools.MoveTool.GetSelectedConnectedParts then
                    local parts = LoadedTools.MoveTool.GetSelectedConnectedParts()
                    if #parts > 0 then return parts end
                end
                if LoadedTools.RotateTool and LoadedTools.RotateTool.GetSelectedConnectedParts then
                    local parts = LoadedTools.RotateTool.GetSelectedConnectedParts()
                    if #parts > 0 then return parts end
                end
                return {}
            end)
            local success = rpmTool.Enable()
            setActive(button, success)
        end
    end)

    yPos = createSlider("Spin RPM", yPos, 1, 3000, 10, function(value)
        if LoadedTools.RPMTool then LoadedTools.RPMTool.SetRPM(value) end
    end)

    -- Spin Axis Selector
    local axisLabelBg = Instance.new("Frame")
    axisLabelBg.Size = UDim2.new(1, -20, 0, 25)
    axisLabelBg.Position = UDim2.new(0, 10, 0, yPos)
    axisLabelBg.BackgroundColor3 = TXT_BG
    axisLabelBg.BorderSizePixel = 0
    axisLabelBg.ZIndex = 66
    axisLabelBg.Parent = miscContent

    local axisLabel = Instance.new("TextLabel")
    axisLabel.Size = UDim2.new(1, -8, 1, 0)
    axisLabel.Position = UDim2.new(0, 4, 0, 0)
    axisLabel.BackgroundTransparency = 1
    axisLabel.Text = "Spin Axis:"
    axisLabel.Font = Enum.Font.Gotham
    axisLabel.TextSize = 12
    axisLabel.TextColor3 = TEXT_COL
    axisLabel.TextXAlignment = Enum.TextXAlignment.Left
    axisLabel.ZIndex = 67
    axisLabel.Parent = axisLabelBg
    yPos = yPos + 30

    local verticalBtn = Instance.new("TextButton")
    verticalBtn.Size = UDim2.new(0, 135, 0, 30)
    verticalBtn.Position = UDim2.new(0, 10, 0, yPos)
    verticalBtn.BackgroundColor3 = BTN_ON
    verticalBtn.BorderSizePixel = 0
    verticalBtn.Text = "Vertical"
    verticalBtn.Font = Enum.Font.Gotham
    verticalBtn.TextSize = 12
    verticalBtn.TextColor3 = TEXT_COL
    verticalBtn.AutoButtonColor = false
    verticalBtn.ZIndex = 68
    verticalBtn.Parent = miscContent

    local vc = Instance.new("UICorner")
    vc.CornerRadius = UDim.new(0, 6)
    vc.Parent = verticalBtn

    local horizontalBtn = Instance.new("TextButton")
    horizontalBtn.Size = UDim2.new(0, 135, 0, 30)
    horizontalBtn.Position = UDim2.new(0, 155, 0, yPos)
    horizontalBtn.BackgroundColor3 = BTN_OFF
    horizontalBtn.BorderSizePixel = 0
    horizontalBtn.Text = "Horizontal"
    horizontalBtn.Font = Enum.Font.Gotham
    horizontalBtn.TextSize = 12
    horizontalBtn.TextColor3 = TEXT_COL
    horizontalBtn.AutoButtonColor = false
    horizontalBtn.ZIndex = 68
    horizontalBtn.Parent = miscContent

    local hc = Instance.new("UICorner")
    hc.CornerRadius = UDim.new(0, 6)
    hc.Parent = horizontalBtn

    verticalBtn.MouseButton1Click:Connect(function()
        if LoadedTools.RPMTool then LoadedTools.RPMTool.SetAxis("Vertical") end
        verticalBtn.BackgroundColor3 = BTN_ON
        horizontalBtn.BackgroundColor3 = BTN_OFF
    end)

    horizontalBtn.MouseButton1Click:Connect(function()
        if LoadedTools.RPMTool then LoadedTools.RPMTool.SetAxis("Horizontal") end
        horizontalBtn.BackgroundColor3 = BTN_ON
        verticalBtn.BackgroundColor3 = BTN_OFF
    end)

    yPos = yPos + 45

    -- SAFE-NOS Section
    yPos = createSectionTitle("SAFE-NOS", yPos)

    safeNosBtn, yPos = createButton("Safe-NOS", yPos, function(button)
        if getgenv().SafeNOSEnabled then
            getgenv().SafeNOSEnabled = false
            setActive(button, false)
            button.Text = "Safe-NOS"
            if getgenv().SafeNOSConnection then
                getgenv().SafeNOSConnection:Disconnect()
                getgenv().SafeNOSConnection = nil
            end
        else
            getgenv().SafeNOSEnabled = true
            setActive(button, true)
            button.Text = "Safe-NOS (ON)"
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            getgenv().SafeNOSConnection = RunService.Heartbeat:Connect(function()
                if not getgenv().SafeNOSEnabled then return end
                for _, part in ipairs(workspace:GetDescendants()) do
                    if part:IsA("BasePart") then
                        for _, child in ipairs(part:GetChildren()) do
                            if child.Name == "MoveToolPosition" or child.Name == "MoveToolGyro" or
                               child.Name == "RingPosition" or child.Name == "RingGyro" or
                               child.Name == "SpinVelocity" then
                                local hasOwnership = part:CanSetNetworkOwnership()
                                if hasOwnership then
                                    local owner = part:GetNetworkOwner()
                                    if owner ~= LocalPlayer then
                                        child:Destroy()
                                        print("Safe-NOS: Cleared force from " .. part.Name .. " (lost ownership)")
                                    end
                                end
                                break
                            end
                        end
                    end
                end
            end)
        end
    end)

    local safeInfoBg = Instance.new("Frame")
    safeInfoBg.Size = UDim2.new(1, -20, 0, 40)
    safeInfoBg.Position = UDim2.new(0, 10, 0, yPos)
    safeInfoBg.BackgroundColor3 = TXT_BG
    safeInfoBg.BorderSizePixel = 0
    safeInfoBg.ZIndex = 66
    safeInfoBg.Parent = miscContent

    local safeNosInfo = Instance.new("TextLabel")
    safeNosInfo.Size = UDim2.new(1, -8, 1, 0)
    safeNosInfo.Position = UDim2.new(0, 4, 0, 0)
    safeNosInfo.BackgroundTransparency = 1
    safeNosInfo.Text = "Automatically removes forces when\nyou lose network ownership"
    safeNosInfo.Font = Enum.Font.Gotham
    safeNosInfo.TextSize = 11
    safeNosInfo.TextColor3 = TEXT_COL
    safeNosInfo.TextXAlignment = Enum.TextXAlignment.Left
    safeNosInfo.TextYAlignment = Enum.TextYAlignment.Top
    safeNosInfo.TextWrapped = true
    safeNosInfo.ZIndex = 67
    safeNosInfo.Parent = safeInfoBg
    yPos = yPos + 50

    -- DISABLE AAS Section
    yPos = createSectionTitle("DISABLE AAS", yPos)

    local disableAASBtn
    disableAASBtn, yPos = createButton("Disable AAS", yPos, function(button)
        if getgenv().DisableAASEnabled then
            getgenv().DisableAASEnabled = false
            setActive(button, false)
            button.Text = "Disable AAS"
            if getgenv().DisableAASConnection then
                pcall(function() task.cancel(getgenv().DisableAASConnection) end)
                getgenv().DisableAASConnection = nil
            end
        else
            getgenv().DisableAASEnabled = true
            setActive(button, true)
            button.Text = "Disable AAS (ON)"
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            getgenv().DisableAASConnection = task.spawn(function()
                while getgenv().DisableAASEnabled do
                    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        local hrp = LocalPlayer.Character.HumanoidRootPart
                        hrp.CFrame = hrp.CFrame + Vector3.new(0, 3, 0)
                        if getgenv().FlipPlayerEnabled then
                            hrp.CFrame = hrp.CFrame * CFrame.Angles(math.pi, 0, 0)
                        end
                    end
                    task.wait(0.5)
                end
            end)
        end
    end)

    -- Flip Player Checkbox
    local flipContainer = Instance.new("Frame")
    flipContainer.Size = UDim2.new(1, -20, 0, 30)
    flipContainer.Position = UDim2.new(0, 10, 0, yPos)
    flipContainer.BackgroundTransparency = 1
    flipContainer.ZIndex = 65
    flipContainer.Parent = miscContent

    local flipCheckbox = Instance.new("TextButton")
    flipCheckbox.Size = UDim2.new(0, 25, 0, 25)
    flipCheckbox.Position = UDim2.new(0, 0, 0, 0)
    flipCheckbox.BackgroundColor3 = CHECK_OFF
    flipCheckbox.BorderSizePixel = 0
    flipCheckbox.Text = ""
    flipCheckbox.AutoButtonColor = false
    flipCheckbox.ZIndex = 68
    flipCheckbox.Parent = flipContainer

    local fcc = Instance.new("UICorner")
    fcc.CornerRadius = UDim.new(0, 4)
    fcc.Parent = flipCheckbox

    local checkmark = Instance.new("TextLabel")
    checkmark.Size = UDim2.new(1, 0, 1, 0)
    checkmark.BackgroundTransparency = 1
    checkmark.Text = ""
    checkmark.Font = Enum.Font.GothamBold
    checkmark.TextSize = 18
    checkmark.TextColor3 = TEXT_COL
    checkmark.ZIndex = 69
    checkmark.Parent = flipCheckbox

    local flipLabelBg = Instance.new("Frame")
    flipLabelBg.Size = UDim2.new(1, -35, 1, 0)
    flipLabelBg.Position = UDim2.new(0, 35, 0, 0)
    flipLabelBg.BackgroundColor3 = TXT_BG
    flipLabelBg.BorderSizePixel = 0
    flipLabelBg.ZIndex = 66
    flipLabelBg.Parent = flipContainer

    local flipLabel = Instance.new("TextLabel")
    flipLabel.Size = UDim2.new(1, -8, 1, 0)
    flipLabel.Position = UDim2.new(0, 4, 0, 0)
    flipLabel.BackgroundTransparency = 1
    flipLabel.Text = "Flip Player"
    flipLabel.Font = Enum.Font.Gotham
    flipLabel.TextSize = 12
    flipLabel.TextColor3 = TEXT_COL
    flipLabel.TextXAlignment = Enum.TextXAlignment.Left
    flipLabel.ZIndex = 67
    flipLabel.Parent = flipLabelBg

    getgenv().FlipPlayerEnabled = false

    flipCheckbox.MouseButton1Click:Connect(function()
        getgenv().FlipPlayerEnabled = not getgenv().FlipPlayerEnabled
        if getgenv().FlipPlayerEnabled then
            flipCheckbox.BackgroundColor3 = CHECK_ON
            checkmark.Text = "âœ“"
        else
            flipCheckbox.BackgroundColor3 = CHECK_OFF
            checkmark.Text = ""
        end
    end)

    yPos = yPos + 40

    local aasInfoBg = Instance.new("Frame")
    aasInfoBg.Size = UDim2.new(1, -20, 0, 40)
    aasInfoBg.Position = UDim2.new(0, 10, 0, yPos)
    aasInfoBg.BackgroundColor3 = TXT_BG
    aasInfoBg.BorderSizePixel = 0
    aasInfoBg.ZIndex = 66
    aasInfoBg.Parent = miscContent

    local aasInfo = Instance.new("TextLabel")
    aasInfo.Size = UDim2.new(1, -8, 1, 0)
    aasInfo.Position = UDim2.new(0, 4, 0, 0)
    aasInfo.BackgroundTransparency = 1
    aasInfo.Text = "Moves you up by 3 studs every 0.5s\nOptionally flips character upside down"
    aasInfo.Font = Enum.Font.Gotham
    aasInfo.TextSize = 11
    aasInfo.TextColor3 = TEXT_COL
    aasInfo.TextXAlignment = Enum.TextXAlignment.Left
    aasInfo.TextYAlignment = Enum.TextYAlignment.Top
    aasInfo.TextWrapped = true
    aasInfo.ZIndex = 67
    aasInfo.Parent = aasInfoBg
    yPos = yPos + 50

    miscContent.CanvasSize = UDim2.new(0, 0, 0, yPos + 20)
end

function MiscModule.Cleanup()
    if LoadedTools.MoveTool then LoadedTools.MoveTool.Disable() end
    if LoadedTools.RotateTool then LoadedTools.RotateTool.Disable() end
    if LoadedTools.RingShape then LoadedTools.RingShape.Disable() end
    if LoadedTools.RPMTool then LoadedTools.RPMTool.Disable() end
    if getgenv().SafeNOSConnection then
        getgenv().SafeNOSConnection:Disconnect()
        getgenv().SafeNOSConnection = nil
    end
    getgenv().SafeNOSEnabled = false
    if getgenv().DisableAASConnection then
        pcall(function() task.cancel(getgenv().DisableAASConnection) end)
        getgenv().DisableAASConnection = nil
    end
    getgenv().DisableAASEnabled = false
    getgenv().FlipPlayerEnabled = false
end

return MiscModule
