-- Combat Module - Main GUI
-- Loads Hitbox and Aimlock scripts from GitHub

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

local CombatModule = {}

local HITBOX_URL = "https://raw.githubusercontent.com/givenship/Unanchor.euva/refs/heads/main/Hitbox"
local AIMLOCK_URL = "https://raw.githubusercontent.com/givenship/Unanchor.euva/refs/heads/main/Aimlock"
local AUTODEFUSE_URL = "https://raw.githubusercontent.com/givenship/Unanchor.euva/refs/heads/main/Auto.defuse"

local TEXT_COL = Color3.fromRGB(184, 193, 206)
local BTN_OFF = Color3.fromRGB(255, 255, 255)
local BTN_ON = Color3.fromRGB(184, 193, 206)
local SLIDER_BG = Color3.fromRGB(255, 255, 255)
local SLIDER_FILL = Color3.fromRGB(184, 193, 206)
local CHECK_OFF = Color3.fromRGB(180, 180, 180)
local CHECK_ON = Color3.fromRGB(255, 255, 255)
local TXT_BG = Color3.fromRGB(255, 255, 255)

local function addPadding(frame, lr, tb)
    local pad = Instance.new("UIPadding")
    pad.PaddingLeft = UDim.new(0, lr or 4)
    pad.PaddingRight = UDim.new(0, lr or 4)
    pad.PaddingTop = UDim.new(0, tb or 0)
    pad.PaddingBottom = UDim.new(0, tb or 0)
    pad.Parent = frame
end

getgenv().HitboxSettings = {
    Enabled = false,
    UsePositionOffset = false,
    HitboxLeft = 0,
    HitboxRight = 0,
    HitboxUp = 0,
    HitboxDown = 0,
    HitboxFront = 0,
    HitboxBack = 0,
    HitboxPosX = 0,
    HitboxPosY = 0,
    HitboxPosZ = 0,
    HitboxTransparency = 0.5,
    PreviewTransparency = 0.7,
    TeamCheck = false,
    VisibilityCheck = false
}

getgenv().AimlockSettings = {
    Enabled = false,
    Smoothness = 1,
    ShowFOV = false,
    FOVSize = 100,
    TeamCheck = false,
    VisibilityCheck = false
}

getgenv().AutoDefuseSettings = {
    Enabled = false,
    Delay = 3000,
    ShowCircle = true,
    DetectionRadius = 30
}

local hitboxLoaded = false
local aimlockLoaded = false
local autoDefuseLoaded = false

local function loadScript(url)
    print("Attempting to load from: " .. url)
    local success, result = pcall(function()
        return game:HttpGet(url)
    end)
    if not success then
        warn("HTTP GET failed: " .. tostring(result))
        return false
    end
    if not result or result == "" then
        warn("Empty response from GitHub")
        return false
    end
    print("Script downloaded, size: " .. #result .. " bytes")
    local loadSuccess, loadResult = pcall(function()
        return loadstring(result)()
    end)
    if not loadSuccess then
        warn("loadstring failed: " .. tostring(loadResult))
        return false
    end
    return true
end

function CombatModule.CreateUI(parent)
    local combatContent = Instance.new("ScrollingFrame")
    combatContent.Name = "CombatContent"
    combatContent.Size = UDim2.new(1, -20, 1, -20)
    combatContent.Position = UDim2.new(0, 10, 0, 10)
    combatContent.BackgroundTransparency = 1
    combatContent.BorderSizePixel = 0
    combatContent.ScrollBarThickness = 4
    combatContent.ScrollBarImageColor3 = Color3.fromRGB(200, 180, 190)
    combatContent.Parent = parent

    local yPos = 10

    -- Section title with white background
    local function createSectionTitle(text, position)
        local bg = Instance.new("Frame")
        bg.Size = UDim2.new(0, 0, 0, 28)
        bg.AutomaticSize = Enum.AutomaticSize.X
        bg.Position = UDim2.new(0, 10, 0, position)
        bg.BackgroundColor3 = TXT_BG
        bg.BorderSizePixel = 0
        bg.ZIndex = 66
        bg.Parent = combatContent
        addPadding(bg, 6, 0)

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0, 0, 1, 0)
        label.AutomaticSize = Enum.AutomaticSize.X
        label.BackgroundTransparency = 1
        label.Text = text
        label.Font = Enum.Font.GothamBold
        label.TextSize = 15
        label.TextColor3 = TEXT_COL
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 67
        label.Parent = bg
        return position + 38
    end

    local function createToggleButton(name, settingsTable, settingKey, position, callback)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(1, -20, 0, 50)
        container.Position = UDim2.new(0, 10, 0, position)
        container.BackgroundTransparency = 1
        container.ZIndex = 65
        container.Parent = combatContent

        local labelBg = Instance.new("Frame")
        labelBg.Size = UDim2.new(0, 0, 0, 40)
        labelBg.Position = UDim2.new(0, 0, 0, 5)
        labelBg.AutomaticSize = Enum.AutomaticSize.X
        labelBg.BackgroundColor3 = TXT_BG
        labelBg.BorderSizePixel = 0
        labelBg.ZIndex = 66
        labelBg.Parent = container
        addPadding(labelBg, 6, 0)

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0, 0, 1, 0)
        label.AutomaticSize = Enum.AutomaticSize.X
        label.BackgroundTransparency = 1
        label.Text = name
        label.Font = Enum.Font.GothamBold
        label.TextSize = 14
        label.TextColor3 = TEXT_COL
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 67
        label.Parent = labelBg

        local toggleButton = Instance.new("TextButton")
        toggleButton.Size = UDim2.new(0, 140, 0, 40)
        toggleButton.Position = UDim2.new(1, -140, 0, 5)
        toggleButton.BackgroundColor3 = BTN_OFF
        toggleButton.BorderSizePixel = 0
        toggleButton.Text = "DISABLED"
        toggleButton.Font = Enum.Font.GothamBold
        toggleButton.TextSize = 14
        toggleButton.TextColor3 = TEXT_COL
        toggleButton.AutoButtonColor = false
        toggleButton.ZIndex = 68
        toggleButton.Parent = container

        toggleButton.MouseButton1Click:Connect(function()
            settingsTable[settingKey] = not settingsTable[settingKey]
            if settingsTable[settingKey] then
                toggleButton.BackgroundColor3 = BTN_ON
                toggleButton.Text = "ENABLED"
            else
                toggleButton.BackgroundColor3 = BTN_OFF
                toggleButton.Text = "DISABLED"
            end
            if callback then callback(settingsTable[settingKey]) end
        end)

        return position + 60
    end

    local function createSlider(name, settingsTable, settingKey, minVal, maxVal, position)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(1, -20, 0, 50)
        container.Position = UDim2.new(0, 10, 0, position)
        container.BackgroundTransparency = 1
        container.ZIndex = 65
        container.Parent = combatContent

        local labelBg = Instance.new("Frame")
        labelBg.Size = UDim2.new(0, 0, 0, 20)
        labelBg.Position = UDim2.new(0, 0, 0, 5)
        labelBg.AutomaticSize = Enum.AutomaticSize.X
        labelBg.BackgroundColor3 = TXT_BG
        labelBg.BorderSizePixel = 0
        labelBg.ZIndex = 66
        labelBg.Parent = container
        addPadding(labelBg, 4, 0)

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0, 0, 1, 0)
        label.AutomaticSize = Enum.AutomaticSize.X
        label.BackgroundTransparency = 1
        label.Text = name .. ": " .. settingsTable[settingKey]
        label.Font = Enum.Font.Gotham
        label.TextSize = 12
        label.TextColor3 = TEXT_COL
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 67
        label.Parent = labelBg

        local sliderBg = Instance.new("Frame")
        sliderBg.Size = UDim2.new(1, -110, 0, 20)
        sliderBg.Position = UDim2.new(0, 105, 0, 25)
        sliderBg.BackgroundColor3 = SLIDER_BG
        sliderBg.BorderSizePixel = 0
        sliderBg.ZIndex = 68
        sliderBg.Parent = container

        local sc = Instance.new("UICorner")
        sc.CornerRadius = UDim.new(0, 4)
        sc.Parent = sliderBg

        local sliderFill = Instance.new("Frame")
        sliderFill.Size = UDim2.new((settingsTable[settingKey] - minVal) / (maxVal - minVal), 0, 1, 0)
        sliderFill.BackgroundColor3 = SLIDER_FILL
        sliderFill.BorderSizePixel = 0
        sliderFill.ZIndex = 69
        sliderFill.Parent = sliderBg

        local fc = Instance.new("UICorner")
        fc.CornerRadius = UDim.new(0, 4)
        fc.Parent = sliderFill

        local sliderButton = Instance.new("TextButton")
        sliderButton.Size = UDim2.new(1, 0, 1, 0)
        sliderButton.BackgroundTransparency = 1
        sliderButton.Text = ""
        sliderButton.ZIndex = 70
        sliderButton.Parent = sliderBg

        local dragging = false
        sliderButton.MouseButton1Down:Connect(function() dragging = true end)
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
        end)
        RunService.RenderStepped:Connect(function()
            if dragging then
                local mouse = UserInputService:GetMouseLocation()
                local relativeX = math.clamp(mouse.X - sliderBg.AbsolutePosition.X, 0, sliderBg.AbsoluteSize.X)
                local percentage = relativeX / sliderBg.AbsoluteSize.X
                local value = math.floor(minVal + (maxVal - minVal) * percentage)
                settingsTable[settingKey] = value
                sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
                label.Text = name .. ": " .. value
            end
        end)
        return position + 60
    end

    local function createTransparencySlider(name, settingsTable, settingKey, position)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(1, -20, 0, 50)
        container.Position = UDim2.new(0, 10, 0, position)
        container.BackgroundTransparency = 1
        container.ZIndex = 65
        container.Parent = combatContent

        local labelBg = Instance.new("Frame")
        labelBg.Size = UDim2.new(0, 0, 0, 20)
        labelBg.Position = UDim2.new(0, 0, 0, 5)
        labelBg.AutomaticSize = Enum.AutomaticSize.X
        labelBg.BackgroundColor3 = TXT_BG
        labelBg.BorderSizePixel = 0
        labelBg.ZIndex = 66
        labelBg.Parent = container
        addPadding(labelBg, 4, 0)

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0, 0, 1, 0)
        label.AutomaticSize = Enum.AutomaticSize.X
        label.BackgroundTransparency = 1
        label.Text = name .. ": " .. string.format("%.2f", settingsTable[settingKey])
        label.Font = Enum.Font.Gotham
        label.TextSize = 12
        label.TextColor3 = TEXT_COL
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 67
        label.Parent = labelBg

        local sliderBg = Instance.new("Frame")
        sliderBg.Size = UDim2.new(1, -130, 0, 20)
        sliderBg.Position = UDim2.new(0, 125, 0, 25)
        sliderBg.BackgroundColor3 = SLIDER_BG
        sliderBg.BorderSizePixel = 0
        sliderBg.ZIndex = 68
        sliderBg.Parent = container

        local sc = Instance.new("UICorner")
        sc.CornerRadius = UDim.new(0, 4)
        sc.Parent = sliderBg

        local sliderFill = Instance.new("Frame")
        sliderFill.Size = UDim2.new(settingsTable[settingKey], 0, 1, 0)
        sliderFill.BackgroundColor3 = SLIDER_FILL
        sliderFill.BorderSizePixel = 0
        sliderFill.ZIndex = 69
        sliderFill.Parent = sliderBg

        local fc = Instance.new("UICorner")
        fc.CornerRadius = UDim.new(0, 4)
        fc.Parent = sliderFill

        local sliderButton = Instance.new("TextButton")
        sliderButton.Size = UDim2.new(1, 0, 1, 0)
        sliderButton.BackgroundTransparency = 1
        sliderButton.Text = ""
        sliderButton.ZIndex = 70
        sliderButton.Parent = sliderBg

        local dragging = false
        sliderButton.MouseButton1Down:Connect(function() dragging = true end)
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
        end)
        RunService.RenderStepped:Connect(function()
            if dragging then
                local mouse = UserInputService:GetMouseLocation()
                local relativeX = math.clamp(mouse.X - sliderBg.AbsolutePosition.X, 0, sliderBg.AbsoluteSize.X)
                local percentage = relativeX / sliderBg.AbsoluteSize.X
                settingsTable[settingKey] = percentage
                sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
                label.Text = name .. ": " .. string.format("%.2f", percentage)
            end
        end)
        return position + 60
    end

    local function createCheckbox(name, settingsTable, settingKey, position)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(1, -20, 0, 30)
        container.Position = UDim2.new(0, 10, 0, position)
        container.BackgroundTransparency = 1
        container.ZIndex = 65
        container.Parent = combatContent

        local checkbox = Instance.new("TextButton")
        checkbox.Size = UDim2.new(0, 20, 0, 20)
        checkbox.Position = UDim2.new(0, 0, 0, 5)
        checkbox.BackgroundColor3 = CHECK_OFF
        checkbox.BackgroundTransparency = 0
        checkbox.BorderSizePixel = 0
        checkbox.Text = ""
        checkbox.AutoButtonColor = false
        checkbox.ZIndex = 68
        checkbox.Parent = container

        local checkmark = Instance.new("TextLabel")
        checkmark.Size = UDim2.new(1, 0, 1, 0)
        checkmark.BackgroundTransparency = 1
        checkmark.Text = ""
        checkmark.Font = Enum.Font.GothamBold
        checkmark.TextSize = 16
        checkmark.TextColor3 = TEXT_COL
        checkmark.ZIndex = 69
        checkmark.Parent = checkbox

        local labelBg = Instance.new("Frame")
        labelBg.Size = UDim2.new(0, 0, 0, 30)
        labelBg.Position = UDim2.new(0, 30, 0, 0)
        labelBg.AutomaticSize = Enum.AutomaticSize.X
        labelBg.BackgroundColor3 = TXT_BG
        labelBg.BorderSizePixel = 0
        labelBg.ZIndex = 66
        labelBg.Parent = container
        addPadding(labelBg, 6, 0)

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0, 0, 1, 0)
        label.AutomaticSize = Enum.AutomaticSize.X
        label.BackgroundTransparency = 1
        label.Text = name
        label.Font = Enum.Font.Gotham
        label.TextSize = 14
        label.TextColor3 = TEXT_COL
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 67
        label.Parent = labelBg

        checkbox.MouseButton1Click:Connect(function()
            settingsTable[settingKey] = not settingsTable[settingKey]
            if settingsTable[settingKey] then
                checkbox.BackgroundColor3 = CHECK_ON
                checkmark.Text = "✓"
            else
                checkbox.BackgroundColor3 = CHECK_OFF
                checkmark.Text = ""
            end
        end)
        return position + 40
    end

    -- HITBOX ADJUSTMENT
    yPos = createSectionTitle("HITBOX ADJUSTMENT", yPos)

    yPos = createToggleButton("Hitbox", getgenv().HitboxSettings, "Enabled", yPos, function(enabled)
        if not hitboxLoaded then
            print("Loading Hitbox script from GitHub...")
            hitboxLoaded = loadScript(HITBOX_URL)
            if not hitboxLoaded then
                warn("Failed to load Hitbox script from GitHub")
                getgenv().HitboxSettings.Enabled = false
                return
            end
            print("Hitbox script loaded successfully!")
        end
        if not getgenv().HitboxControl then
            warn("HitboxControl not found after loading")
            getgenv().HitboxSettings.Enabled = false
            return
        end
        if enabled then getgenv().HitboxControl.Start() else getgenv().HitboxControl.Stop() end
    end)

    -- Directional controls
    local function createDirectionalControl(name, directions, position)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(1, -20, 0, 100)
        container.Position = UDim2.new(0, 10, 0, position)
        container.BackgroundTransparency = 1
        container.ZIndex = 65
        container.Parent = combatContent

        local labelBg = Instance.new("Frame")
        labelBg.Size = UDim2.new(0, 0, 0, 20)
        labelBg.AutomaticSize = Enum.AutomaticSize.X
        labelBg.BackgroundColor3 = TXT_BG
        labelBg.BorderSizePixel = 0
        labelBg.ZIndex = 66
        labelBg.Parent = container
        addPadding(labelBg, 4, 0)

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0, 0, 1, 0)
        label.AutomaticSize = Enum.AutomaticSize.X
        label.BackgroundTransparency = 1
        label.Text = name
        label.Font = Enum.Font.GothamBold
        label.TextSize = 14
        label.TextColor3 = TEXT_COL
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 67
        label.Parent = labelBg

        for i, dir in ipairs(directions) do
            local sliderContainer = Instance.new("Frame")
            sliderContainer.Size = UDim2.new(1, -40, 0, 30)
            sliderContainer.Position = UDim2.new(0, 35, 0, 20 + (i - 1) * 35)
            sliderContainer.BackgroundTransparency = 1
            sliderContainer.ZIndex = 65
            sliderContainer.Parent = container

            local dirLabel = Instance.new("TextLabel")
            dirLabel.Size = UDim2.new(0, 25, 0, 20)
            dirLabel.Position = UDim2.new(0, -35, 0, 5)
            dirLabel.BackgroundColor3 = TXT_BG
            dirLabel.BorderSizePixel = 0
            dirLabel.Text = dir.label
            dirLabel.Font = Enum.Font.GothamBold
            dirLabel.TextSize = 14
            dirLabel.TextColor3 = TEXT_COL
            dirLabel.ZIndex = 67
            dirLabel.Parent = sliderContainer

            local valueBg = Instance.new("Frame")
            valueBg.Size = UDim2.new(0, 30, 0, 20)
            valueBg.Position = UDim2.new(0, 0, 0, 5)
            valueBg.BackgroundColor3 = TXT_BG
            valueBg.BorderSizePixel = 0
            valueBg.ZIndex = 66
            valueBg.Parent = sliderContainer

            local valueLabel = Instance.new("TextLabel")
            valueLabel.Size = UDim2.new(1, 0, 1, 0)
            valueLabel.BackgroundTransparency = 1
            valueLabel.Text = tostring(getgenv().HitboxSettings[dir.key] or 0)
            valueLabel.Font = Enum.Font.Gotham
            valueLabel.TextSize = 12
            valueLabel.TextColor3 = TEXT_COL
            valueLabel.TextXAlignment = Enum.TextXAlignment.Right
            valueLabel.ZIndex = 67
            valueLabel.Parent = valueBg

            local sliderBg = Instance.new("Frame")
            sliderBg.Size = UDim2.new(1, -35, 0, 20)
            sliderBg.Position = UDim2.new(0, 35, 0, 5)
            sliderBg.BackgroundColor3 = SLIDER_BG
            sliderBg.BorderSizePixel = 0
            sliderBg.ZIndex = 68
            sliderBg.Parent = sliderContainer

            local sc = Instance.new("UICorner")
            sc.CornerRadius = UDim.new(0, 4)
            sc.Parent = sliderBg

            local sliderFill = Instance.new("Frame")
            sliderFill.Size = UDim2.new((getgenv().HitboxSettings[dir.key] or 0) / 20, 0, 1, 0)
            sliderFill.BackgroundColor3 = SLIDER_FILL
            sliderFill.BorderSizePixel = 0
            sliderFill.ZIndex = 69
            sliderFill.Parent = sliderBg

            local fc = Instance.new("UICorner")
            fc.CornerRadius = UDim.new(0, 4)
            fc.Parent = sliderFill

            local sliderButton = Instance.new("TextButton")
            sliderButton.Size = UDim2.new(1, 0, 1, 0)
            sliderButton.BackgroundTransparency = 1
            sliderButton.Text = ""
            sliderButton.ZIndex = 70
            sliderButton.Parent = sliderBg

            local dragging = false
            sliderButton.MouseButton1Down:Connect(function() dragging = true end)
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
            end)
            RunService.RenderStepped:Connect(function()
                if dragging then
                    local mouse = UserInputService:GetMouseLocation()
                    local relativeX = math.clamp(mouse.X - sliderBg.AbsolutePosition.X, 0, sliderBg.AbsoluteSize.X)
                    local percentage = relativeX / sliderBg.AbsoluteSize.X
                    local value = math.floor(0 + (20 - 0) * percentage)
                    getgenv().HitboxSettings[dir.key] = value
                    sliderFill.Size = UDim2.new(value / 20, 0, 1, 0)
                    valueLabel.Text = tostring(value)
                end
            end)
        end
        return position + 110
    end

    yPos = createDirectionalControl("Hitbox X", {
        {label = "L", key = "HitboxLeft"},
        {label = "R", key = "HitboxRight"}
    }, yPos)
    yPos = createDirectionalControl("Hitbox Y", {
        {label = "U", key = "HitboxUp"},
        {label = "D", key = "HitboxDown"}
    }, yPos)
    yPos = createDirectionalControl("Hitbox Z", {
        {label = "F", key = "HitboxFront"},
        {label = "B", key = "HitboxBack"}
    }, yPos)
    yPos = createTransparencySlider("Transparency", getgenv().HitboxSettings, "HitboxTransparency", yPos)
    yPos = createTransparencySlider("Preview Transp.", getgenv().HitboxSettings, "PreviewTransparency", yPos)

    -- Warning label
    local warnBg = Instance.new("Frame")
    warnBg.Size = UDim2.new(1, -20, 0, 40)
    warnBg.Position = UDim2.new(0, 10, 0, yPos)
    warnBg.BackgroundColor3 = TXT_BG
    warnBg.BorderSizePixel = 0
    warnBg.ZIndex = 66
    warnBg.Parent = combatContent

    local warningLabel = Instance.new("TextLabel")
    warningLabel.Size = UDim2.new(1, -8, 1, 0)
    warningLabel.Position = UDim2.new(0, 4, 0, 0)
    warningLabel.BackgroundTransparency = 1
    warningLabel.Text = "⚠️ Position Offset (NOT RECOMMENDED - May cause bugs)"
    warningLabel.Font = Enum.Font.Gotham
    warningLabel.TextSize = 12
    warningLabel.TextColor3 = Color3.fromRGB(200, 50, 50)
    warningLabel.TextXAlignment = Enum.TextXAlignment.Left
    warningLabel.TextWrapped = true
    warningLabel.ZIndex = 67
    warningLabel.Parent = warnBg
    yPos = yPos + 45

    yPos = createToggleButton("Use Position Offset", getgenv().HitboxSettings, "UsePositionOffset", yPos, nil)
    yPos = createSlider("Position X", getgenv().HitboxSettings, "HitboxPosX", -10, 10, yPos)
    yPos = createSlider("Position Y", getgenv().HitboxSettings, "HitboxPosY", -10, 10, yPos)
    yPos = createSlider("Position Z", getgenv().HitboxSettings, "HitboxPosZ", -10, 10, yPos)
    yPos = createCheckbox("Visibility Check", getgenv().HitboxSettings, "VisibilityCheck", yPos)
    yPos = createCheckbox("Team Check", getgenv().HitboxSettings, "TeamCheck", yPos)

    yPos = yPos + 10

    -- AIMLOCK
    yPos = createSectionTitle("AIMLOCK", yPos)

    yPos = createToggleButton("Aimlock", getgenv().AimlockSettings, "Enabled", yPos, function(enabled)
        if not aimlockLoaded then
            print("Loading Aimlock script from GitHub...")
            aimlockLoaded = loadScript(AIMLOCK_URL)
            if not aimlockLoaded then
                warn("Failed to load Aimlock script from GitHub")
                getgenv().AimlockSettings.Enabled = false
                return
            end
            print("Aimlock script loaded successfully!")
        end
        if not getgenv().AimlockControl then
            warn("AimlockControl not found after loading")
            getgenv().AimlockSettings.Enabled = false
            return
        end
        if enabled then getgenv().AimlockControl.Start() else getgenv().AimlockControl.Stop() end
    end)

    yPos = createSlider("Smoothness", getgenv().AimlockSettings, "Smoothness", 1, 20, yPos)
    yPos = createSlider("FOV Size", getgenv().AimlockSettings, "FOVSize", 50, 500, yPos)
    yPos = createCheckbox("Show FOV Circle", getgenv().AimlockSettings, "ShowFOV", yPos)
    yPos = createCheckbox("Visibility Check", getgenv().AimlockSettings, "VisibilityCheck", yPos)
    yPos = createCheckbox("Team Check", getgenv().AimlockSettings, "TeamCheck", yPos)

    yPos = yPos + 10

    -- AUTO DEFUSE
    yPos = createSectionTitle("AUTO DEFUSE", yPos)

    yPos = createToggleButton("Auto Defuse", getgenv().AutoDefuseSettings, "Enabled", yPos, function(enabled)
        if not autoDefuseLoaded then
            print("Loading Auto Defuse script from GitHub...")
            autoDefuseLoaded = loadScript(AUTODEFUSE_URL)
            if not autoDefuseLoaded then
                warn("Failed to load Auto Defuse script from GitHub")
                getgenv().AutoDefuseSettings.Enabled = false
                return
            end
            print("Auto Defuse script loaded successfully!")
        end
        if not getgenv().AutoDefuseControl then
            warn("AutoDefuseControl not found after loading")
            getgenv().AutoDefuseSettings.Enabled = false
            return
        end
        if enabled then getgenv().AutoDefuseControl.Start() else getgenv().AutoDefuseControl.Stop() end
    end)

    yPos = createSlider("Delay (ms)", getgenv().AutoDefuseSettings, "Delay", 0, 5000, yPos)
    yPos = createSlider("Detection Radius", getgenv().AutoDefuseSettings, "DetectionRadius", 10, 100, yPos)
    yPos = createCheckbox("Show Circle", getgenv().AutoDefuseSettings, "ShowCircle", yPos)

    combatContent.CanvasSize = UDim2.new(0, 0, 0, yPos + 20)
end

function CombatModule.Cleanup()
    if hitboxLoaded and getgenv().HitboxControl then getgenv().HitboxControl.Stop() end
    if aimlockLoaded and getgenv().AimlockControl then getgenv().AimlockControl.Stop() end
    if autoDefuseLoaded and getgenv().AutoDefuseControl then getgenv().AutoDefuseControl.Stop() end
end

return CombatModule
