-- Euva Settings Module (Updated)
-- Uses new component system and matches theme

local SettingsModule = {}
SettingsModule.Theme = nil
SettingsModule.Components = nil
SettingsModule.ui = nil
SettingsModule.Layout = nil -- Optional, for blur/transparency control

function SettingsModule.SetTheme(theme)
    SettingsModule.Theme = theme
end

function SettingsModule.SetComponents(comp)
    SettingsModule.Components = comp
end

function SettingsModule.SetUI(uiFn)
    SettingsModule.ui = uiFn
end

function SettingsModule.SetLayout(layout)
    SettingsModule.Layout = layout
end

function SettingsModule.CreateUI(parent)
    local Theme = SettingsModule.Theme
    local Components = SettingsModule.Components
    local ui = SettingsModule.ui or Components.ui
    local THEME = Theme.Colors
    
    -- APPEARANCE Section
    local appearanceSection = Components.CreateSection(parent, "APPEARANCE")
    
    -- GUI Transparency slider (default 10%)
    Components.CreateSlider(appearanceSection, "GUI Transparency", 10, 0, 100, function(value)
        if SettingsModule.Layout and SettingsModule.Layout.SetGuiTransparency then
            SettingsModule.Layout.SetGuiTransparency(value / 100)
        end
    end)
    
    -- Background Blur slider
    Components.CreateSlider(appearanceSection, "Background Blur", 0, 0, 100, function(value)
        if SettingsModule.Layout and SettingsModule.Layout.SetBlur then
            SettingsModule.Layout.SetBlur(value / 100)
        end
    end)
    
    -- Decoration Transparency slider
    Components.CreateSlider(appearanceSection, "Decoration Transparency", 80, 0, 100, function(value)
        -- If Decorations module is available
        local Deco = rawget(_G, "EuvaDeco")
        if Deco and Deco.SetTransparency then
            Deco.SetTransparency(value / 100)
        end
    end)
    
    -- SCRIPT MANAGEMENT Section
    local scriptSection = Components.CreateSection(parent, "SCRIPT MANAGEMENT")
    
    local reloadBtn = Components.CreateButton(scriptSection, "üîÑ Reload Script", function()
        -- Destroy all Euva GUIs
        local CoreGui = game:GetService("CoreGui")
        local Lighting = game:GetService("Lighting")
        
        -- Remove blur
        local blur = Lighting:FindFirstChild("EuvaBlur")
        if blur then blur:Destroy() end
        
        -- Remove GUI
        local gui = CoreGui:FindFirstChild("EuvaMainGUI")
        if gui then gui:Destroy() end
        
        print("[Euva] GUI destroyed - Re-execute script to reload")
    end)
    reloadBtn.Size = UDim2.new(1, -20, 0, 40)
    
    Components.CreateLabel(scriptSection, "Note: Re-execute your script to reload.", true)
    
    -- KEYBINDS Section
    local keybindsSection = Components.CreateSection(parent, "KEYBINDS")
    
    local keybindData = {
        {"Right Shift", "Toggle GUI visibility"},
        {"Drag Toggle", "Enable/disable dragging parts (Misc tab)"},
    }
    
    for _, kb in ipairs(keybindData) do
        local row = ui("Frame", {
            Size = UDim2.new(1, 0, 0, 24),
            BackgroundTransparency = 1,
            Parent = keybindsSection,
        })
        
        ui("TextLabel", {
            Size = UDim2.new(0, 100, 1, 0),
            BackgroundTransparency = 1,
            Text = kb[1],
            Font = Enum.Font.GothamBold,
            TextSize = 12,
            TextColor3 = THEME.Text,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = row,
        })
        
        ui("TextLabel", {
            Size = UDim2.new(1, -110, 1, 0),
            Position = UDim2.new(0, 110, 0, 0),
            BackgroundTransparency = 1,
            Text = "- " .. kb[2],
            Font = Enum.Font.Gotham,
            TextSize = 12,
            TextColor3 = THEME.TextMuted,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = row,
        })
    end
    
    -- INFORMATION Section
    local infoSection = Components.CreateSection(parent, "INFORMATION")
    
    local infoText = [[Euva GUI v2.0

Features:
‚Ä¢ Visual - ESP, Health Bars, Object ESP
‚Ä¢ Combat - Hitbox Expander, Aimlock, Auto Defuse
‚Ä¢ Player - Reset, Jump Height, Noclip, Invisible
‚Ä¢ Misc - Part tools (Move, Rotate, Ring, RPM)
‚Ä¢ Settings - Appearance, Keybinds

Made with ‚ù§Ô∏è]]
    
    ui("TextLabel", {
        Size = UDim2.new(1, 0, 0, 120),
        BackgroundTransparency = 1,
        Text = infoText,
        Font = Enum.Font.Gotham,
        TextSize = 12,
        TextColor3 = THEME.TextMuted,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        TextWrapped = true,
        Parent = infoSection,
    })
    
    -- Discord button at bottom
    local discordBtn = Components.CreateButton(infoSection, "Join Discord", function()
        Components.TryClipboard(Theme.Config.DiscordInvite)
    end, true)
    discordBtn.Size = UDim2.new(1, -20, 0, 36)
end

function SettingsModule.Cleanup()
    -- No cleanup needed
end

return SettingsModule
