-- Euva Settings Module
-- Compatible with Euva pink theme layout system
-- All ZIndex >= 65 to render above deco ImageLabels

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

local SettingsModule = {}
SettingsModule.Layout = nil -- Set by Main before CreateUI

local TXT_BG = Color3.fromRGB(255, 255, 255)
local BTN_OFF = Color3.fromRGB(255, 255, 255)
local BTN_ON = Color3.fromRGB(184, 193, 206)
local SLIDER_BG = Color3.fromRGB(255, 255, 255)
local SLIDER_FILL = Color3.fromRGB(184, 193, 206)
local TEXT_COL = Color3.fromRGB(184, 193, 206)
local Z_BG = 66
local Z_TEXT = 67
local Z_BTN = 68
local Z_FILL = 69
local Z_KNOB = 70

local function addPadding(frame, lr, tb)
    local pad = Instance.new("UIPadding")
    pad.PaddingLeft = UDim.new(0, lr or 4)
    pad.PaddingRight = UDim.new(0, lr or 4)
    pad.PaddingTop = UDim.new(0, tb or 0)
    pad.PaddingBottom = UDim.new(0, tb or 0)
    pad.Parent = frame
end

function SettingsModule.CreateUI(parent)
    local settingsContent = Instance.new("ScrollingFrame")
    settingsContent.Size = UDim2.new(1, 0, 1, 0)
    settingsContent.BackgroundTransparency = 1
    settingsContent.BorderSizePixel = 0
    settingsContent.ScrollBarThickness = 4
    settingsContent.ScrollBarImageColor3 = Color3.fromRGB(200, 180, 190)
    settingsContent.CanvasSize = UDim2.new(0, 0, 0, 0)
    settingsContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
    settingsContent.ZIndex = 65
    settingsContent.Parent = parent

    local listLayout = Instance.new("UIListLayout")
    listLayout.Padding = UDim.new(0, 12)
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Parent = settingsContent

    -- ============================================
    -- GUI TRANSPARENCY
    -- ============================================

    local transTitle = Instance.new("Frame")
    transTitle.Size = UDim2.new(0, 0, 0, 28)
    transTitle.AutomaticSize = Enum.AutomaticSize.X
    transTitle.BackgroundColor3 = TXT_BG
    transTitle.BorderSizePixel = 0
    transTitle.ZIndex = Z_BG
    transTitle.LayoutOrder = 0
    transTitle.Parent = settingsContent
    addPadding(transTitle, 6, 0)

    local transTitleText = Instance.new("TextLabel")
    transTitleText.Size = UDim2.new(0, 0, 1, 0)
    transTitleText.AutomaticSize = Enum.AutomaticSize.X
    transTitleText.BackgroundTransparency = 1
    transTitleText.Text = "GUI TRANSPARENCY"
    transTitleText.Font = Enum.Font.GothamBold
    transTitleText.TextSize = 15
    transTitleText.TextColor3 = TEXT_COL
    transTitleText.TextXAlignment = Enum.TextXAlignment.Left
    transTitleText.ZIndex = Z_TEXT
    transTitleText.Parent = transTitle

    local defaultTrans = 0.1
    if SettingsModule.Layout and SettingsModule.Layout.GetGuiTransparency then
        defaultTrans = SettingsModule.Layout.GetGuiTransparency()
    end

    local transValueBg = Instance.new("Frame")
    transValueBg.Size = UDim2.new(0, 0, 0, 24)
    transValueBg.AutomaticSize = Enum.AutomaticSize.X
    transValueBg.BackgroundColor3 = TXT_BG
    transValueBg.BorderSizePixel = 0
    transValueBg.ZIndex = Z_BG
    transValueBg.LayoutOrder = 1
    transValueBg.Parent = settingsContent
    addPadding(transValueBg, 6, 0)

    local transValueLabel = Instance.new("TextLabel")
    transValueLabel.Size = UDim2.new(0, 0, 1, 0)
    transValueLabel.AutomaticSize = Enum.AutomaticSize.X
    transValueLabel.BackgroundTransparency = 1
    transValueLabel.Text = "Transparency: " .. math.floor(defaultTrans * 100) .. "%"
    transValueLabel.Font = Enum.Font.Gotham
    transValueLabel.TextSize = 13
    transValueLabel.TextColor3 = TEXT_COL
    transValueLabel.TextXAlignment = Enum.TextXAlignment.Left
    transValueLabel.ZIndex = Z_TEXT
    transValueLabel.Parent = transValueBg

    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(1, -20, 0, 30)
    sliderFrame.BackgroundColor3 = SLIDER_BG
    sliderFrame.BorderSizePixel = 0
    sliderFrame.ZIndex = Z_BTN
    sliderFrame.LayoutOrder = 2
    sliderFrame.Parent = settingsContent

    local sliderCorner = Instance.new("UICorner")
    sliderCorner.CornerRadius = UDim.new(0, 6)
    sliderCorner.Parent = sliderFrame

    local normalized = math.clamp(defaultTrans, 0, 1)
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new(normalized, 0, 1, 0)
    fill.BackgroundColor3 = SLIDER_FILL
    fill.BorderSizePixel = 0
    fill.ZIndex = Z_FILL
    fill.Parent = sliderFrame

    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 6)
    fillCorner.Parent = fill

    local knob = Instance.new("TextButton")
    knob.Size = UDim2.new(0, 20, 0, 20)
    knob.Position = UDim2.new(1, -10, 0.5, -10)
    knob.AnchorPoint = Vector2.new(1, 0)
    knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    knob.BorderSizePixel = 0
    knob.Text = ""
    knob.ZIndex = Z_KNOB
    knob.Parent = fill

    local knobCorner = Instance.new("UICorner")
    knobCorner.CornerRadius = UDim.new(1, 0)
    knobCorner.Parent = knob

    local dragging = false

    knob.MouseButton1Down:Connect(function()
        dragging = true
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType ~= Enum.UserInputType.MouseMovement then return end
        if not dragging then return end

        local mouseX = UserInputService:GetMouseLocation().X
        local x0 = sliderFrame.AbsolutePosition.X
        local w = sliderFrame.AbsoluteSize.X
        local rel = math.clamp((mouseX - x0) / w, 0, 1)

        fill.Size = UDim2.new(rel, 0, 1, 0)
        transValueLabel.Text = "Transparency: " .. math.floor(rel * 100) .. "%"

        if SettingsModule.Layout and SettingsModule.Layout.SetGuiTransparency then
            SettingsModule.Layout.SetGuiTransparency(rel)
        end
    end)

    -- ============================================
    -- COMPACT GUI
    -- ============================================

    local compactTitleBg = Instance.new("Frame")
    compactTitleBg.Size = UDim2.new(0, 0, 0, 28)
    compactTitleBg.AutomaticSize = Enum.AutomaticSize.X
    compactTitleBg.BackgroundColor3 = TXT_BG
    compactTitleBg.BorderSizePixel = 0
    compactTitleBg.ZIndex = Z_BG
    compactTitleBg.LayoutOrder = 2.1
    compactTitleBg.Parent = settingsContent
    addPadding(compactTitleBg, 6, 0)

    local compactTitleText = Instance.new("TextLabel")
    compactTitleText.Size = UDim2.new(0, 0, 1, 0)
    compactTitleText.AutomaticSize = Enum.AutomaticSize.X
    compactTitleText.BackgroundTransparency = 1
    compactTitleText.Text = "COMPACT GUI"
    compactTitleText.Font = Enum.Font.GothamBold
    compactTitleText.TextSize = 15
    compactTitleText.TextColor3 = TEXT_COL
    compactTitleText.TextXAlignment = Enum.TextXAlignment.Left
    compactTitleText.ZIndex = Z_TEXT
    compactTitleText.Parent = compactTitleBg

    local isCompact = getgenv().EuvaCompactGUI == true

    -- apply compact on load if was enabled
    local function applyCompact(enabled)
        getgenv().EuvaCompactGUI = enabled
        if SettingsModule.Layout and SettingsModule.Layout.MainFrame then
            local mf = SettingsModule.Layout.MainFrame
            local existing = mf:FindFirstChild("CompactScale")
            if enabled then
                if not existing then
                    local scale = Instance.new("UIScale")
                    scale.Name = "CompactScale"
                    scale.Scale = 0.7
                    scale.Parent = mf
                end
            else
                if existing then existing:Destroy() end
            end
        end
    end

    local compactBtn = Instance.new("TextButton")
    compactBtn.Size = UDim2.new(1, -20, 0, 36)
    compactBtn.BackgroundColor3 = isCompact and BTN_ON or BTN_OFF
    compactBtn.BorderSizePixel = 0
    compactBtn.Text = isCompact and "Compact GUI: ON" or "Compact GUI: OFF"
    compactBtn.Font = Enum.Font.GothamBold
    compactBtn.TextSize = 14
    compactBtn.TextColor3 = TEXT_COL
    compactBtn.AutoButtonColor = false
    compactBtn.ZIndex = Z_BTN
    compactBtn.LayoutOrder = 2.2
    compactBtn.Parent = settingsContent

    compactBtn.MouseEnter:Connect(function()
        if not isCompact then compactBtn.BackgroundColor3 = BTN_ON end
    end)
    compactBtn.MouseLeave:Connect(function()
        if not isCompact then compactBtn.BackgroundColor3 = BTN_OFF end
    end)

    compactBtn.MouseButton1Click:Connect(function()
        isCompact = not isCompact
        compactBtn.Text = isCompact and "Compact GUI: ON" or "Compact GUI: OFF"
        compactBtn.BackgroundColor3 = isCompact and BTN_ON or BTN_OFF
        applyCompact(isCompact)
    end)

    -- apply on load
    if isCompact then
        task.defer(function()
            applyCompact(true)
        end)
    end

    local compactNote = Instance.new("Frame")
    compactNote.Size = UDim2.new(1, -20, 0, 24)
    compactNote.BackgroundColor3 = TXT_BG
    compactNote.BorderSizePixel = 0
    compactNote.ZIndex = Z_BG
    compactNote.LayoutOrder = 2.3
    compactNote.Parent = settingsContent

    local compactNoteText = Instance.new("TextLabel")
    compactNoteText.Size = UDim2.new(1, -8, 1, 0)
    compactNoteText.Position = UDim2.new(0, 4, 0, 0)
    compactNoteText.BackgroundTransparency = 1
    compactNoteText.Text = "Scales the entire GUI to 70% size"
    compactNoteText.Font = Enum.Font.Gotham
    compactNoteText.TextSize = 11
    compactNoteText.TextColor3 = TEXT_COL
    compactNoteText.TextXAlignment = Enum.TextXAlignment.Left
    compactNoteText.TextWrapped = true
    compactNoteText.ZIndex = Z_TEXT
    compactNoteText.Parent = compactNote

    -- ============================================
    -- SCRIPT MANAGEMENT
    -- ============================================

    local reloadTitleBg = Instance.new("Frame")
    reloadTitleBg.Size = UDim2.new(0, 0, 0, 28)
    reloadTitleBg.AutomaticSize = Enum.AutomaticSize.X
    reloadTitleBg.BackgroundColor3 = TXT_BG
    reloadTitleBg.BorderSizePixel = 0
    reloadTitleBg.ZIndex = Z_BG
    reloadTitleBg.LayoutOrder = 3
    reloadTitleBg.Parent = settingsContent
    addPadding(reloadTitleBg, 6, 0)

    local reloadTitle = Instance.new("TextLabel")
    reloadTitle.Size = UDim2.new(0, 0, 1, 0)
    reloadTitle.AutomaticSize = Enum.AutomaticSize.X
    reloadTitle.BackgroundTransparency = 1
    reloadTitle.Text = "SCRIPT MANAGEMENT"
    reloadTitle.Font = Enum.Font.GothamBold
    reloadTitle.TextSize = 15
    reloadTitle.TextColor3 = TEXT_COL
    reloadTitle.TextXAlignment = Enum.TextXAlignment.Left
    reloadTitle.ZIndex = Z_TEXT
    reloadTitle.Parent = reloadTitleBg

    local reloadButton = Instance.new("TextButton")
    reloadButton.Size = UDim2.new(1, -20, 0, 42)
    reloadButton.BackgroundColor3 = BTN_OFF
    reloadButton.BorderSizePixel = 0
    reloadButton.Text = "Reload Script"
    reloadButton.Font = Enum.Font.GothamBold
    reloadButton.TextSize = 14
    reloadButton.TextColor3 = TEXT_COL
    reloadButton.AutoButtonColor = false
    reloadButton.ZIndex = Z_BTN
    reloadButton.LayoutOrder = 4
    reloadButton.Parent = settingsContent

    reloadButton.MouseEnter:Connect(function()
        reloadButton.BackgroundColor3 = BTN_ON
    end)
    reloadButton.MouseLeave:Connect(function()
        reloadButton.BackgroundColor3 = BTN_OFF
    end)

    reloadButton.MouseButton1Click:Connect(function()
        reloadButton.Text = "Reloading..."
        reloadButton.BackgroundColor3 = Color3.fromRGB(255, 200, 200)
        task.wait(0.5)
        for _, gui in pairs(CoreGui:GetChildren()) do
            if gui.Name == "EuvaMainGUI" then gui:Destroy() end
        end
        local blur = game:GetService("Lighting"):FindFirstChild("EuvaBlur")
        if blur then blur:Destroy() end
        print("[Euva] GUI destroyed - Please re-execute your script")
    end)

    local reloadNoteBg = Instance.new("Frame")
    reloadNoteBg.Size = UDim2.new(1, -20, 0, 30)
    reloadNoteBg.BackgroundColor3 = TXT_BG
    reloadNoteBg.BorderSizePixel = 0
    reloadNoteBg.ZIndex = Z_BG
    reloadNoteBg.LayoutOrder = 5
    reloadNoteBg.Parent = settingsContent

    local reloadNote = Instance.new("TextLabel")
    reloadNote.Size = UDim2.new(1, -8, 1, 0)
    reloadNote.Position = UDim2.new(0, 4, 0, 0)
    reloadNote.BackgroundTransparency = 1
    reloadNote.Text = "This will close the GUI. Re-execute your script to reload."
    reloadNote.Font = Enum.Font.Gotham
    reloadNote.TextSize = 11
    reloadNote.TextColor3 = TEXT_COL
    reloadNote.TextXAlignment = Enum.TextXAlignment.Left
    reloadNote.TextWrapped = true
    reloadNote.ZIndex = Z_TEXT
    reloadNote.Parent = reloadNoteBg

    -- ============================================
    -- KEYBINDS
    -- ============================================

    local keybindsTitleBg = Instance.new("Frame")
    keybindsTitleBg.Size = UDim2.new(0, 0, 0, 28)
    keybindsTitleBg.AutomaticSize = Enum.AutomaticSize.X
    keybindsTitleBg.BackgroundColor3 = TXT_BG
    keybindsTitleBg.BorderSizePixel = 0
    keybindsTitleBg.ZIndex = Z_BG
    keybindsTitleBg.LayoutOrder = 6
    keybindsTitleBg.Parent = settingsContent
    addPadding(keybindsTitleBg, 6, 0)

    local keybindsTitle = Instance.new("TextLabel")
    keybindsTitle.Size = UDim2.new(0, 0, 1, 0)
    keybindsTitle.AutomaticSize = Enum.AutomaticSize.X
    keybindsTitle.BackgroundTransparency = 1
    keybindsTitle.Text = "KEYBINDS"
    keybindsTitle.Font = Enum.Font.GothamBold
    keybindsTitle.TextSize = 15
    keybindsTitle.TextColor3 = TEXT_COL
    keybindsTitle.TextXAlignment = Enum.TextXAlignment.Left
    keybindsTitle.ZIndex = Z_TEXT
    keybindsTitle.Parent = keybindsTitleBg

    local keybindInfoBg = Instance.new("Frame")
    keybindInfoBg.Size = UDim2.new(1, -20, 0, 50)
    keybindInfoBg.BackgroundColor3 = TXT_BG
    keybindInfoBg.BorderSizePixel = 0
    keybindInfoBg.ZIndex = Z_BG
    keybindInfoBg.LayoutOrder = 7
    keybindInfoBg.Parent = settingsContent

    local keybindInfo = Instance.new("TextLabel")
    keybindInfo.Size = UDim2.new(1, -8, 1, 0)
    keybindInfo.Position = UDim2.new(0, 4, 0, 0)
    keybindInfo.BackgroundTransparency = 1
    keybindInfo.Text = "Right Shift - Toggle GUI Visibility\n\nPress Right Shift to hide/show the GUI"
    keybindInfo.Font = Enum.Font.Gotham
    keybindInfo.TextSize = 12
    keybindInfo.TextColor3 = TEXT_COL
    keybindInfo.TextXAlignment = Enum.TextXAlignment.Left
    keybindInfo.TextWrapped = true
    keybindInfo.ZIndex = Z_TEXT
    keybindInfo.Parent = keybindInfoBg

    -- ============================================
    -- INFORMATION
    -- ============================================

    local infoTitleBg = Instance.new("Frame")
    infoTitleBg.Size = UDim2.new(0, 0, 0, 28)
    infoTitleBg.AutomaticSize = Enum.AutomaticSize.X
    infoTitleBg.BackgroundColor3 = TXT_BG
    infoTitleBg.BorderSizePixel = 0
    infoTitleBg.ZIndex = Z_BG
    infoTitleBg.LayoutOrder = 8
    infoTitleBg.Parent = settingsContent
    addPadding(infoTitleBg, 6, 0)

    local infoTitle = Instance.new("TextLabel")
    infoTitle.Size = UDim2.new(0, 0, 1, 0)
    infoTitle.AutomaticSize = Enum.AutomaticSize.X
    infoTitle.BackgroundTransparency = 1
    infoTitle.Text = "INFORMATION"
    infoTitle.Font = Enum.Font.GothamBold
    infoTitle.TextSize = 15
    infoTitle.TextColor3 = TEXT_COL
    infoTitle.TextXAlignment = Enum.TextXAlignment.Left
    infoTitle.ZIndex = Z_TEXT
    infoTitle.Parent = infoTitleBg

    local infoTextBg = Instance.new("Frame")
    infoTextBg.Size = UDim2.new(1, -20, 0, 100)
    infoTextBg.BackgroundColor3 = TXT_BG
    infoTextBg.BorderSizePixel = 0
    infoTextBg.ZIndex = Z_BG
    infoTextBg.LayoutOrder = 9
    infoTextBg.Parent = settingsContent

    local infoText = Instance.new("TextLabel")
    infoText.Size = UDim2.new(1, -8, 1, 0)
    infoText.Position = UDim2.new(0, 4, 0, 0)
    infoText.BackgroundTransparency = 1
    infoText.Text = "Euva GUI v3.0\n\nFeatures:\n- Combat: Hitbox, Aimlock, Auto Defuse\n- Visual: ESP, Health Bars, Object ESP\n- Player: Reset, JumpHeight, Noclip\n- Misc: MoveTool, RotateTool, RingShape, RPM, Safe-NOS\n- Univ: Server Join\n- Settings: Transparency, Script Management"
    infoText.Font = Enum.Font.Gotham
    infoText.TextSize = 12
    infoText.TextColor3 = TEXT_COL
    infoText.TextXAlignment = Enum.TextXAlignment.Left
    infoText.TextYAlignment = Enum.TextYAlignment.Top
    infoText.TextWrapped = true
    infoText.ZIndex = Z_TEXT
    infoText.Parent = infoTextBg
end

function SettingsModule.Cleanup()
end

return SettingsModule
